{{ define "main" }}

{{/* minimize js if production; adapted from https://github.com/gohugoio/hugo/issues/9132 */}}
{{ $params := (dict "is_production" hugo.IsProduction ) }}
{{ $sourceMap := cond hugo.IsProduction "" "inline" }}
{{ $buildOptions := dict "sourceMap" $sourceMap "minify" hugo.IsProduction "target" "es2018" "params" $params }}
{{ $js := resources.Get "js/timetree.js" | js.Build $buildOptions | fingerprint }}

<div id="timetree">

  <data class="leaf-data" value='{{ partial "leaf_data.json" . }}'></data>
</div>

<aside>
  <button class="close" aria-label="close details"><i class="ph-x" aria-hidden="true"></i></button>
  <button class="tag" id="current-tag" aria-label="active tag"></button> {{/* layout placeholder for active tag button */}}
  {{/* introduction content */}}
  <article id="intro">
    <header>
      <h1>{{ .Params.Title }}</h1>
    </header>
    <div>{{- .Content -}}</div>
  </article>

  <div id="leaf-details">
    <article/>
  </div>
</aside>

{{/* include visual debug controls unless this is a production build */}}
{{ if not hugo.IsProduction }}
<div id="debug-controls">
<h2>Visual debug</h2>

<p>Control layer visibility (0 - 100%)</p>

<div>
  <label>Debug
  <input type="range" id="debug-visible" name="debug-visible"
         min="0" max="100" value="0">
  </label>
  <label>Leaves
  <input type="range" id="leaf-visible" name="leaf-visible"
         min="0" max="100" value="100">
  </label>
  <label>Labels
  <input type="range" id="label-visible" name="label-visible"
         min="0" max="100" value="100">
  </label>
</div>
{{ end }}

<script src="{{ $js.RelPermalink }}" integrity="{{ $js.Data.Integrity }}" defer></script>
{{ end }} {{/* end main */}}

